---
import { type CollectionEntry, getCollection } from "astro:content";
import Base from "../../components/Base.astro";
import { Icon } from "astro-icon/components";
import Prose from "../../components/Prose.astro";
import TableOfContents from "../../components/TableOfContents.astro";
import { render } from "astro:content";

export async function getStaticPaths() {
    const posts = await getCollection("docs");
    return posts.map((post) => ({
        params: { slug: post.id },
        props: post,
    }));
}
type Props = CollectionEntry<"docs">;

const post = Astro.props;
const { Content } = await render(post);
---

<!doctype html>
<html lang="en">
    <head>
        <Base />
    </head>
    <body
        class="bg-neutral-900 min-h-screen
        bg-[radial-gradient(circle,#73737350_1px,transparent_1px)]
        bg-[size:20px_20px] scroll-smooth"
    >
        <div class="flex flex-row min-h-screen">
            <!-- Desktop sidebar -->
            <div class="hidden md:block flex-shrink-0 w-80 ml-5">
                <div
                    class="sticky top-5
                    bg-neutral-900
                    my-5 rounded-2xl
                    border-dashed border border-neutral-700
                    h-[calc(100vh-2.5rem)] overflow-y-auto"
                >
                    <!-- Title -->
                    <div class="w-full h-fit px-5 pt-5 pb-10">
                        <div class="text-3xl font-bold text-zinc-100">
                            Title
                        </div>
                    </div>

                    <!-- Search -->
                    <form class="px-5 text-zinc-50 relative">
                        <label class="ml-5 absolute -top-2 left-5 text-[10px]"
                            >Search</label
                        >
                        <input
                            class="w-full h-fit border-dashed border border-neutral-700 rounded-full text-sm px-5 py-4 bg-black
                            focus:outline-none focus:border-orange-500"
                            type="text"
                            placeholder="Enter text to search"
                        />
                        <div
                            class="flex items-center gap-2 absolute top-0 right-0 h-full mr-5"
                        >
                            <button
                                type="submit"
                                class="relative h-full text-2xl aspect-square rounded-full bg-orange-500 text-gray-100 font-bold border border-dashed border-gray-100 cursor-pointer"
                                title="Submit search"
                            >
                                <span
                                    class="absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2"
                                >
                                    <Icon name="search" />
                                </span>
                            </button>
                        </div>
                    </form>

                    <!-- Links -->
                    <div class="flex flex-row px-5 py-3 gap-5 text-orange-500">
                        <a
                            href="https://github.com/jobot2397/portfolio"
                            class="flex items-baseline gap-1 border border-transparent hover:bg-neutral-800 hover:border-neutral-700 hover:border-dashed p-2 rounded-full"
                        >
                            Github<Icon name="link" class="self-center" />
                        </a>
                        <a
                            href="https://github.com/jobot2397/portfolio"
                            class="flex items-baseline gap-1 border border-transparent hover:bg-neutral-800 hover:border-neutral-700 hover:border-dashed p-2 rounded-full"
                        >
                            Home<Icon name="link" class="self-center" />
                        </a>
                    </div>

                    <!-- Blogs -->
                    <a
                        class="py-5 text-zinc-50 border-dashed border border-neutral-700 border-x-0 flex items-center hover:bg-neutral-800"
                        href="https://github.com/jobot2397/portfolio"
                    >
                        <div
                            class="border-dashed border border-neutral-700 w-4"
                        >
                        </div>
                        <div
                            class="bg-orange-500 w-2 aspect-square rounded-full"
                        >
                        </div>
                        <span class="pl-2">Blog Posts</span>
                    </a>

                    <!-- Tags -->
                    <a
                        class="py-5 text-zinc-50 border-dashed border border-neutral-700 border-x-0 flex items-center hover:bg-neutral-800"
                        href="https://github.com/jobot2397/portfolio"
                    >
                        <div
                            class="border-dashed border border-neutral-700 w-4"
                        >
                        </div>
                        <div
                            class="bg-orange-500 w-2 aspect-square rounded-full"
                        >
                        </div>
                        <span class="pl-2">Tag Lists</span>
                    </a>
                </div>
            </div>

            <!-- Content -->
            <div class="flex-1 max-w-2xl mx-auto">
                <div class="flex flex-col w-full p-5 min-h-screen">
                    <!-- Frontmatter -->
                    <div class="pb-5">
                        <div class="flex flex-row h-fit w-full justify-between">
                            <!-- Path -->
                            <div class="flex gap-2 items-center">
                                <!-- Home -->
                                <button
                                    class="relative h-10 w-10 text-lg aspect-square rounded-full bg-black text-orange-500 font-bold border border-dashed border-neutral-700 cursor-pointer"
                                >
                                    <span
                                        class="absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2"
                                    >
                                        <Icon name="home" />
                                    </span>
                                </button>
                                <!-- TODO make these clickable and match the formatting -->
                                {
                                    post.id
                                        .split("/")
                                        .map((path, index, array) => (
                                            <div key={index}>
                                                <span class="text-white">
                                                    /
                                                </span>
                                                <span class="text-white">
                                                    {path}
                                                </span>
                                            </div>
                                        ))
                                }
                            </div>

                            <!-- Theme TODO change icon -->
                            <div>
                                <button
                                    class="relative h-10 w-10 text-lg aspect-square rounded-full bg-black text-orange-500 font-bold border border-dashed border-neutral-700 cursor-pointer"
                                >
                                    <span
                                        class="absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2"
                                    >
                                        <Icon name="swatch" />
                                    </span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Frontmatter -->
                    <div>
                        <!-- Title -->
                        <div class="text-6xl text-zinc-50 font-bold">
                            {post.data.title}
                        </div>
                        <div
                            class="border-dashed border-neutral-700 border-l border-b"
                        >
                            <!-- Description -->
                            <div class="text-2xl text-zinc-50 p-5">
                                {post.data.description}
                            </div>

                            <!-- Last Modified Date -->
                            <div
                                class="flex flex-row w-full text-zinc-50 text-sm items-center"
                            >
                                <div
                                    class="border-dashed border-neutral-700 border-t w-5"
                                >
                                </div>
                                <span
                                    class="flex flex-row gap-2 items-center p-2"
                                >
                                    <Icon name="calendar" />

                                    Published on
                                    {
                                        new Date(
                                            post.data.updatedDate,
                                        ).toLocaleDateString("en-US", {
                                            year: "numeric",
                                            month: "short",
                                            day: "numeric",
                                        })
                                    }
                                </span>
                                <div
                                    class="border-dashed border-neutral-700 border-t flex-1"
                                >
                                </div>
                                <div class="flex flex-row items-center gap-2">
                                    <div
                                        class="relative h-10 w-10 text-lg aspect-square rounded-full bg-black text-zinc-50 font-bold border border-dashed border-neutral-700 cursor-pointer"
                                    >
                                        <span
                                            class="absolute top-1/2 left-1/2 -translate-y-1/2 -translate-x-1/2"
                                        >
                                            <Icon name="person" />
                                        </span>
                                    </div>
                                    <span>
                                        {post.data.author}
                                    </span>
                                </div>
                            </div>

                            <!-- Table of contents -->
                            <div
                                class="flex flex-row w-full text-zinc-50 text-sm items-center"
                            >
                                <div
                                    class="border-dashed border-neutral-700 border-t w-5"
                                >
                                </div>
                                <span
                                    class="flex flex-row gap-2 items-center p-2 cursor-pointer"
                                >
                                    <!-- TODO make this toggleable -->
                                    <Icon
                                        class="text-orange-500"
                                        name="minus"
                                    />

                                    Table of Contents

                                    <div class="grid">
                                        <TableOfContents />
                                    </div>
                                </span>
                                <div
                                    class="border-dashed border-neutral-700 border-t flex-1"
                                >
                                </div>
                            </div>
                        </div>

                        <!-- Markdown content -->
                        <div class="flex-1">
                            <Prose>
                                <Content />
                            </Prose>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Mobile sidebar -->
            <div class="block md:hidden w-full h-8 fixed bottom-0 bg-red-500">
                Mobile Sidebar
            </div>
        </div>
    </body>
</html>
