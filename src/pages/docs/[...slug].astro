---
import { type CollectionEntry, getCollection } from "astro:content";
import Base from "../../components/Base.astro";
import { Icon } from "astro-icon/components";
import DesktopSidebar from "../../components/docs/sidebar/DesktopSidebar.astro";
import MobileSidebar from "../../components/docs/sidebar/MobileSidebar.astro";
import DocsContent from "../../components/docs/content/DocsContent.astro";
import { buildFileTree } from "../../utils/utils.js";
import { render } from "astro:content";

export async function getStaticPaths() {
    const posts = await getCollection("docs");
    return posts.map((post) => ({
        params: { slug: post.id },
        props: post,
    }));
}
type Props = CollectionEntry<"docs">;
const post = Astro.props;
const { Content, headings } = await render(post);

// Usage
const posts = await getCollection("docs");
const fileTree = buildFileTree(posts);
---

<!doctype html>
<html lang="en">
    <head>
        <Base />
    </head>
    <body
        class="bg-neutral-900 min-h-screen
        bg-[radial-gradient(circle,#73737350_1px,transparent_1px)]
        bg-[size:20px_20px]"
    >
        <div class="flex flex-row min-h-screen">
            <!-- Desktop Sidebar -->
            <DesktopSidebar fileTree={fileTree} />

            <DocsContent Content={Content} headings={headings} post={post} />

            <MobileSidebar />
        </div>
    </body>
</html>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
            anchor.addEventListener("click", function (e) {
                e.preventDefault();

                const target = document.querySelector(
                    this.getAttribute("href"),
                );
                if (target) {
                    target.scrollIntoView({
                        behavior: "smooth",
                        block: "start",
                    });
                }
            });
        });
    });
</script>
